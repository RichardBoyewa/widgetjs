<!DOCTYPE html>  <html> <head>   <title>events.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="core.html">                 core.js               </a>                                           <a class="source" href="events.html">                 events.js               </a>                                           <a class="source" href="htmlCanvas.html">                 htmlCanvas.js               </a>                                           <a class="source" href="router.html">                 router.js               </a>                                           <a class="source" href="widget-extensions.html">                 widget-extensions.js               </a>                                           <a class="source" href="widget.html">                 widget.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               events.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Events.js that lets us bind callbacks to named events. It also lets us group named events into categories.</p>

<h4>Usage:</h4>

<p><strong>As an event buss/dispatcher</strong>. Eg. register and trigger a callback for a named event 'login' in the 'authentication' category:</p>

<pre><code> events.at('authentication').on('login', function(userName) { alert('User ' + userName + ' signed in.');})

 events.at('authentication').trigger('login', 'kalle');
</code></pre>

<p><em>Note:</em> If no category is given the 'default' eventhandler is used. Eg.</p>

<pre><code> events.on('xyz', function() { ... });

 is equivalent to:

 events.at('default').on('xyz', function() { ... });
</code></pre>

<p>Events can also be <strong>mixed into any object</strong>, giving the object the ability to bind and trigger custom named events.</p>

<pre><code> var obj = {};
 jQuery.extend(obj, events.eventhandler());
 obj.on('notification', function(msg) { alert(msg); });

 obj.trigger('notification', 'tada!');
</code></pre>

<p><em>Note:</em> that this will bypass the global eventManager, so local events should be used only
when other objects aren't supposed to capture the events triggered locally.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span><span class="p">([],</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>EventHandler</h3>

<p>Keeps a list of named events. You may bind callbacks to an event with <strong>on()</strong>
or <strong>onceOn()</strong> and remove with <strong>off()</strong>. Use <strong>trigger()</strong> to execute all callbacks for an event.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">eventHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{};</span>
            </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Map of events with name as key</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Lazily makes sure that an event exists for 'name'.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">ensureEventHolderFor</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h4>Public API</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Binds callback to a named event. The callback will be invoked whenever the event is fired.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">binding</span> <span class="o">=</span> <span class="nx">eventBinding</span><span class="p">({</span> <span class="nx">callback</span><span class="o">:</span> <span class="nx">callback</span> <span class="p">});</span>
                <span class="nx">ensureEventHolderFor</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">binding</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">binding</span><span class="p">;</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Removed 'binding' attached to event.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">off</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">binding</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ensureEventHolderFor</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">remove</span><span class="p">(</span><span class="nx">binding</span><span class="p">);</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Like <strong>on()</strong> except only triggered once then removed from the event.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">onceOn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ensureEventHolderFor</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="kd">var</span> <span class="nx">onceEvent</span> <span class="o">=</span> <span class="nx">eventBinding</span><span class="p">({</span>
                    <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">remove</span><span class="p">(</span><span class="nx">onceEvent</span><span class="p">);</span>
                        <span class="nx">callback</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>

                <span class="nx">that</span><span class="p">.</span><span class="nx">bindings</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">onceEvent</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">onceEvent</span><span class="p">;</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Trigger all callbacks attached to event.
Any arguments to trigger is sent as arguments to callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">that</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Event</h3>

<p>Represents an event. Keeps a list of bindings/callbacks that can be added using <strong>push()</strong> and
removed using <strong>remove()</strong>. <em>trigger()</em> executes all callbacks one by one in registration order.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{};</span>

            <span class="kd">var</span> <span class="nx">bindings</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h4>Public API</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Add binding</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">binding</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bindings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">binding</span><span class="p">);</span>
                <span class="nx">binding</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">that</span><span class="p">;</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Remove binding</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">binding</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">binding</span> <span class="o">||</span> <span class="o">!</span><span class="nx">binding</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="s2">&quot;not a binding for event&quot;</span><span class="p">;</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>bindings.remove(binding);</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span><span class="p">(</span><span class="nx">binding</span> <span class="o">==</span> <span class="nx">bindings</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
                <span class="nx">binding</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Trigger event by executing all callbacks one by one in registration order.
'params' can be an object or an array, and will be passed as parameter to
the callback functions of each binding.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">!==</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">params</span> <span class="o">=</span> <span class="p">[</span><span class="nx">params</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">bindings</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3>Event Binding</h3>

<p>Binds a callback to an event</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">eventBinding</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">spec</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">spec</span> <span class="o">=</span> <span class="nx">spec</span> <span class="o">||</span> <span class="p">{};</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{};</span>

            <span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">spec</span><span class="p">.</span><span class="nx">callback</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h4>Public API</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Event</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">spec</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>True if bound to an event</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">isBound</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Remove itself from event, if bound.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">unbind</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">isBound</span><span class="p">())</span> <span class="p">{</span>
                    <span class="nx">that</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">that</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Trigger callback with supplied parameters</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h3>EventManager</h3>

<p>Singleton object that keeps a list of named event categories/holders.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">eventManager</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Map of event handlers (categories of events) with (category) name as key</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">eventHandlers</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h4>Public API</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Register a new event handler with 'name'.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">eventHandlers</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="p">(</span><span class="s1">&#39;A event handler is already registered for &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">eventHandlers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">eventHandler</span><span class="p">();</span>

                <span class="k">return</span> <span class="nx">eventHandlers</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Returns event handler by name. Creates a new handler if
not already registered.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">at</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">eventHandlers</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">that</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="nx">eventHandlers</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Forward <strong>on()</strong>, <strong>onceOn()</strong>, <strong>off()</strong> and <strong>trigger()</strong> to the default event handler</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="nx">that</span><span class="p">.</span><span class="nx">onceOn</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">).</span><span class="nx">onceOn</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="nx">that</span><span class="p">.</span><span class="nx">off</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="nx">that</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
            <span class="p">};</span>

            <span class="nx">that</span><span class="p">.</span><span class="nx">trigger</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">).</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">that</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">).</span><span class="nx">events</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Expose event handler function (to be mixedin into objects and widgets)</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">eventhandler</span> <span class="o">=</span> <span class="nx">eventHandler</span><span class="p">;</span>

            <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
        <span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h3>Default event handler</h3>

<p>Ensure that 'default' category always exists.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">eventManager</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h3>Exports</h3>

<p>Singleton event manager</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">eventManager</span><span class="p">;</span>
    <span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 