/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,n){"function"==typeof define&&define.amd?define(n):t.widgetjs=n(t.$)}(this,function(t){var n,e,r;return function(t){function o(t,n){return w.call(t,n)}function i(t,n){var e,r,o,i,u,a,c,s,l,f,d,p=n&&n.split("/"),h=y.map,g=h&&h["*"]||{};if(t&&"."===t.charAt(0))if(n){for(p=p.slice(0,p.length-1),t=t.split("/"),u=t.length-1,y.nodeIdCompat&&k.test(t[u])&&(t[u]=t[u].replace(k,"")),t=p.concat(t),l=0;l<t.length;l+=1)if(d=t[l],"."===d)t.splice(l,1),l-=1;else if(".."===d){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||g)&&h){for(e=t.split("/"),l=e.length;l>0;l-=1){if(r=e.slice(0,l).join("/"),p)for(f=p.length;f>0;f-=1)if(o=h[p.slice(0,f).join("/")],o&&(o=o[r])){i=o,a=l;break}if(i)break;!c&&g&&g[r]&&(c=g[r],s=l)}!i&&c&&(i=c,a=s),i&&(e.splice(0,a,i),t=e.join("/"))}return t}function u(n,e){return function(){return p.apply(t,T.call(arguments,0).concat([n,e]))}}function a(t){return function(n){return i(n,t)}}function c(t){return function(n){v[t]=n}}function s(n){if(o(m,n)){var e=m[n];delete m[n],b[n]=!0,d.apply(t,e)}if(!o(v,n)&&!o(b,n))throw new Error("No "+n);return v[n]}function l(t){var n,e=t?t.indexOf("!"):-1;return e>-1&&(n=t.substring(0,e),t=t.substring(e+1,t.length)),[n,t]}function f(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,p,h,g,v={},m={},y={},b={},w=Object.prototype.hasOwnProperty,T=[].slice,k=/\.js$/;h=function(t,n){var e,r=l(t),o=r[0];return t=r[1],o&&(o=i(o,n),e=s(o)),o?t=e&&e.normalize?e.normalize(t,a(n)):i(t,n):(t=i(t,n),r=l(t),o=r[0],t=r[1],o&&(e=s(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:e}},g={require:function(t){return u(t)},exports:function(t){var n=v[t];return"undefined"!=typeof n?n:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:f(t)}}},d=function(n,e,r,i){var a,l,f,d,p,y,w=[],T=typeof r;if(i=i||n,"undefined"===T||"function"===T){for(e=!e.length&&r.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(d=h(e[p],i),l=d.f,"require"===l)w[p]=g.require(n);else if("exports"===l)w[p]=g.exports(n),y=!0;else if("module"===l)a=w[p]=g.module(n);else if(o(v,l)||o(m,l)||o(b,l))w[p]=s(l);else{if(!d.p)throw new Error(n+" missing "+l);d.p.load(d.n,u(i,!0),c(l),{}),w[p]=v[l]}f=r?r.apply(v[n],w):void 0,n&&(a&&a.exports!==t&&a.exports!==v[n]?v[n]=a.exports:f===t&&y||(v[n]=f))}else n&&(v[n]=r)},n=e=p=function(n,e,r,o,i){if("string"==typeof n)return g[n]?g[n](e):s(h(n,e).f);if(!n.splice){if(y=n,y.deps&&p(y.deps,y.callback),!e)return;e.splice?(n=e,e=r,r=null):n=t}return e=e||function(){},"function"==typeof r&&(r=o,o=i),o?d(t,n,e,r):setTimeout(function(){d(t,n,e,r)},4),p},p.config=function(t){return p(t)},n._defined=v,r=function(t,n,e){n.splice||(e=n,n=[]),o(v,t)||o(m,t)||(m[t]=[t,n,e])},r.amd={jQuery:!0}}(),r("htmlCanvas",["jquery"],function(t){function n(t){var n=e({element:t}),o={};return o.root=n,o.tag=function(t,r){var o=e({tag:t,children:r});return n.appendBrush(o),o},r.forEach(function(t){o[t]=function(){var n=Array.prototype.slice.call(arguments);return o.tag(t,n)}}),o.omit=function(){return i},o.render=function(){var t=Array.prototype.slice.call(arguments);n.render(t)},o.raw=function(t){n.raw(t)},o.renderNonBreaking=function(t){o.raw(t.replace(/\s/g,"&nbsp;"))},o}function e(e){function r(t){return document.createElement(t)}function a(n){if("undefined"==typeof n||null===n)throw new Error("cannot append null or undefined to brush");if(n!==i)if("object"==typeof n&&n.constructor===Array)for(var e=0;e<n.length;e++)a(n[e]);else"string"==typeof n?l(n):"function"==typeof n?f(n):"object"==typeof n&&n.appendToBrush?n.appendToBrush(p):"object"==typeof n?p.attr(n):t(h).append(n)}function c(t){h.canHaveChildren!==!1?h.appendChild(t):h.text=h.text+t.innerHTML}function s(t){c(t.element())}function l(n){t(h).append(document.createTextNode(n))}function f(t){var e=n(p);t(e)}function d(n){return"undefined"==typeof n||null===n?t(document.createDocumentFragment()).get(0):"object"==typeof n&&n.asJQuery?n.asJQuery().get(0):t(n).get(0)}var p={},h=e.tag?r(e.tag):d(e.element);if(!h)throw new Error("htmlTagBrush requires an element");return p.element=function(){return h},p.render=function(){for(var t=Array.prototype.slice.call(arguments),n=0;n<t.length;n++)a(t[n]);return p},p.appendToBrush=function(t){t.appendBrush(p)},p.appendBrush=s,p.html=function(t){return p.asJQuery().html(t),p},p.raw=function(t){return p.asJQuery().append(t),p},p.renderNonBreaking=function(t){p.raw(t.replace(/\s/g,"&nbsp;"))},p.on=function(t,n){return p.asJQuery().bind(t,n),p},u.forEach(function(t){p[t]=function(n){return p.on(t,n)}}),p.setAttribute=function(t,n){return n===i?p:(h.setAttribute(t,n),p)},o.forEach(function(t){p[t]=function(n){return p.setAttribute(t,n)}}),p.css=function(t,n){return"string"==typeof t?p.asJQuery().css(t,n):p.asJQuery().css(t),p},p.attr=function(t){for(var n in t)t.hasOwnProperty(n)&&("function"==typeof t[n]?p.on(n,t[n]):"klass"===n?p.addClass(t[n]):p.setAttribute(n,t[n]));return p},p.addClass=function(t){return p.asJQuery().addClass(t),p},p.removeClass=function(t){return p.asJQuery().removeClass(t),p},p.asJQuery=function(){return t(p.element())},e.children&&a(e.children),p}var r="a abbr acronym address area article aside audio b bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn div dl dt em embed fieldset figcaption figure footer form frame frameset h1 h2 h3 h4 h5 h6 hr head header hgroup html i iframe img input ins kbd keygen label legend li link map mark meta meter nav noscript object ol optgroup option output p param pre progress q rp rtruby samp script section select small source span strong style sub summarysup table tbody td textarea tfoot th thead time title tr track tt ul varvideo wbr".split(" "),o="href for id media rel src style title type".split(" "),i={},u="blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error dragstart dragenter dragover dragleave drop dragend".split(" ");return n}),r("klassified",[],function(){function t(n,e){n=n||{},e=e||{};var r={};return r.getClass=function(){return t},e.initialize=function(){},e.subclassResponsibility=i,e.get=function(t,n){n||(n=function(){return e[t]}),r["get"+o(t)]=n},e.set=function(t,n){n||(n=function(n){return e[t]=n,n}),r["set"+o(t)]=n},r.getClass().extensions.forEach(function(t){t(r,e)}),r}function n(t,n){Object.keys(t).forEach(function(e){if("function"==typeof n[e]&&"function"==typeof t[e]&&u.test(t[e])&&!t[e].superInstalled){var r=n[e];t[e]=function(n,e){return function(){var n=t.super;t.super=r;var o=e.apply(t,arguments);return t.super=n,void 0===t.super&&delete t.super,o}}(e,t[e]),t[e].superInstalled=!0}})}function e(t){throw new Error("Cannot instantiate an instance of an abstract class")}function r(t){throw new Error("Cannot create new instances of a singleton class, use `instance` instead.")}function o(t){return t[0].toUpperCase()+t.slice(1)}function i(){throw new Error("Subclass responsibility")}t.subclasses=[],t.allSubclasses=function(){var t=this.subclasses.slice();return this.subclasses.forEach(function(n){n.allSubclasses().forEach(function(n){t.push(n)})}),t},t.subclassResponsibility=i,t.extensions=[];var u=/\bsuper\b/;return t.subclass=function(t){function o(a,c,s){a=a||{},c=c||{},o.isAbstract&&!s&&e(i),o.isSingleton&&!s&&r(i);var l=i(a,c,!0);l.getClass=function(){return o};var f=Object.assign({},l),d=Object.assign({},c);return o.extensions.forEach(function(t){t(l,c)}),t(l,c),u.test(t)&&(n(l,f),n(c,d)),s||c.initialize(a),l}var i=this;return o.superclass=i,o.subclasses=[],i.subclasses.push(o),o.classBuilder=i.classBuilder,o.classBuilder(o),o},t.singletonSubclass=function(t){var n=this.subclass(t),e=n();return n.isSingleton=!0,n.instance=function(){return e},n},t.abstractSubclass=function(t){var n=this.subclass(t);return n.isAbstract=!0,n},t.class=function(n){var e=this;if(e===t)throw new Error("object class should not be extended.");var r=e.classBuilder;e.classBuilder=function(t){r(t),n(t)},e.classBuilder(e)},t.classBuilder=function(n){n.class=t.class,n.subclass=t.subclass,n.singletonSubclass=t.singletonSubclass,n.abstractSubclass=t.abstractSubclass,n.allSubclasses=t.allSubclasses,n.subclassResponsibility=i,n.extend=t.extend,n.extensions=[]},t.extend=function(t){this.extensions.push(t)},"function"!=typeof Object.assign&&!function(){Object.assign=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),e=1;e<arguments.length;e++){var r=arguments[e];if(void 0!==r&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(n[o]=r[o])}return n}}(),t}),r("widget-extensions",[],function(){return{}}),r("router/url",["klassified"],function(t){function n(t){return t.split(o).filter(Boolean)}function e(t){return t.replace(/\?.*$/g,"")}function r(t){var n,e=/[^?]*\?(.*)$/g.exec(t),r={};return e&&e.length>=2&&e[1].split("&").forEach(function(t){n=t.split("="),r[n[0]]=n[1]}),r}var o="/",i=t.subclass(function(t,o){var i,u,a,c;o.initialize=function(t){o.super(t),i=t.rawUrl||"",u=e(i),a=r(i),c=n(u)},t.getPath=function(){return u},t.getQuery=function(){return a},t.getSegments=function(){return c},t.matchRoute=function(n){return n.matchUrl(t)},t.toString=function(){return i}});return i.build=function(t,n){if("undefined"==typeof t||null===t||"string"!=typeof t)throw"accepts only string paths";if(n){var e=decodeURIComponent(jQuery.param(n));if(e)return i({rawUrl:t+"?"+e})}return i({rawUrl:t})},i}),r("router/abstractSegment",["klassified"],function(t){var n=t.subclass(function(t,n){n.initialize=function(t){n.super(t),n.segmentString=t.segmentString,n.options=t.options||{}},t.match=function(t){return!1},t.getValue=function(t){return n.segmentString},t.isParameter=function(){return!1},t.isOptional=function(){return!1},t.toString=function(){return n.segmentString}});return n.class(function(t){t.match=function(t){return!1}}),n}),r("router/parameterSegment",["./abstractSegment"],function(t){function n(t){if("function"==typeof t)return t;if(t instanceof RegExp){var n=new RegExp(t);return function(t){return n.test(t)}}if("[object Array]"===Object.prototype.toString.call(t)){var e=t.map(function(t){return t.toLowerCase()});return function(t){var n=t.toLowerCase();return e.indexOf(n)!==-1}}return null}var e=t.subclass(function(t,e){e.initialize=function(t){e.super(t),e.name=e.segmentString.substr(1),e.constraints=e.options.constraints&&e.options.constraints[e.name]&&[e.options.constraints[e.name]]||[],e.validators=e.constraints.map(n).filter(Boolean)},t.getName=function(){return e.name},t.getValue=function(t){return t},t.isParameter=function(){return!0},t.match=function(n){return void 0!==n&&t.validate(n)},t.validate=function(t){return e.validators.every(function(n){return n(t)})},t.toString=function(){return"param("+t.getName()+")"}});return e.class(function(t){t.match=function(t){return"#"===t.substr(0,1)}}),e}),r("router/optionalParameterSegment",["./parameterSegment"],function(t){var n=t.subclass(function(t,n){n.initialize=function(t){n.super(t),n.defaultValue=n.options.defaults&&n.options.defaults[n.name]},t.getValue=function(t){return void 0===t?n.defaultValue:t},t.isOptional=function(){return!0},t.toString=function(){return"optional("+t.getName()+")"}});return n.class(function(t){t.match=function(t){return"?"===t.substr(0,1)}}),n}),r("router/staticSegment",["./abstractSegment"],function(t){var n=t.subclass(function(t,n){return t.match=function(n){return t.getValue()===n},t});return n.class(function(t){t.match=function(t){return["#","?"].indexOf(t[0])===-1}}),n}),r("router/routeFactory",["./parameterSegment","./optionalParameterSegment","./staticSegment","./abstractSegment"],function(t,n,e,r){function o(t,n){if(!t)return[];n=n||{};var e=t.split(u),r=e.map(Function.prototype.call,String.prototype.trim).filter(Boolean),o=r.map(function(t){return i(t,n)});return o}function i(t,n){n=n||{};for(var e=r.allSubclasses(),o=0;o<e.length;o++){var i=e[o];if(i.match(t))return i({segmentString:t,options:n})}return null}var u="/";return o}),r("events",[],function(){var t=function(t,n){function e(t){var n=i({callback:t,event:r});return o.push(n),n}n=n||{};var r=function(t){return e(t)},o=[];r.on=function(t){return e(t)};var i=function(t){t=t||{};var n={},e=t.callback,r=t.event;return n.isBound=function(){return void 0!==r},n.unbind=function(){n.isBound()&&(r.off(n),r=void 0)},n.bind=function(t){n.unbind(),t&&(r=t)},n.execute=function(t){e&&e.apply(n,t)},n};return r.onceOn=function(t){var e=i({callback:function(){n.remove(e),t.apply(r,arguments)}});return o.push(e),e},r.off=function(t){n.remove(t)},r.trigger=function(){var t=Array.prototype.slice.call(arguments);o.forEach(function(n){n.execute(t)})},r.dispose=function(){o.slice().forEach(function(t){t.unbind()})},n.push=function(t){o.push(t),t.bind(r)},n.remove=function(t){o.splice(o.indexOf(t),1)},r},n=function(){function n(n){return e(n)||r(t(),n),i[n]}function e(t){return void 0!==i[t]}function r(t,n){return u.push(t),n&&(i[n]=t),t}var o={},i={},u=[];return o.createEvent=function(n){return r(t(),n)},o.on=function(t,e){return n(t).on(e)},o.off=function(t,e){return n(t).off(e)},o.onceOn=function(t,e){return n(t).onceOn(e)},o.trigger=function(t){var e=Array.prototype.slice.call(arguments,1),r=n(t);r.trigger.apply(o,e)},o.dispose=function(){u.forEach(function(t){t.dispose()}),i={},u=[]},o},e=function(){var t={},e={};return t.register=function(t){if(e[t])throw"A event category is already registered for "+t;return e[t]=n(),e[t]},t.at=function(n){return e[n]||t.register(n),e[n]},t}();return e.eventCategory=n,e.eventhandler=n,e.event=t,e}),r("router/routeMatchResult",["klassified"],function(t){var n=t.subclass(function(t,n){function e(t,n){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o]);return e}var r,o,i,u,a;n.initialize=function(t){n.super(t),r=t.url,o=t.route,i=r&&r.getQuery&&r.getQuery()||{},u=t.values||{},a=e(u,i)},t.getRoute=function(){return o},t.getUrl=function(){return r},t.isMatch=function(){return!0},t.getRouteParameters=function(){return u},t.getQueryParameters=function(){return r.getQuery()},t.getParameters=function(){return a},t.getActionArguments=function(){var t=Object.keys(u).map(function(t){return u[t]});return t.push(r.getQuery()),t}});return n.class(function(t){t.routeNoMatchResult=function(){var n=t();return n.isMatch=function(){return!1},n}()}),n}),r("router/route",["./routeFactory","../events","./routeMatchResult","jquery","./url","klassified"],function(t,n,e,r,o,i){function u(t){var n,e,r=[],o=Math.pow(2,t.length);for(e=1;e<o;e++){n=[];var i=t.length-1;do 0!==(e&1<<i)&&n.unshift(t[i]);while(i--);r.unshift(n)}return r}var a=i.subclass(function(r,i){function a(t,n){return n=n||f,!(t.length!==n.length&&!d)&&n.every(function(n,e){var r=t[e];return void 0!==r&&n.match(r)})}function c(t){var n=t.getSegments();if(a(n))return f;var e;for(e=0;e<p.length;e++)if(a(n,p[e]))return p[e];return null}function s(){var t=[];if(f.forEach(function(n,e){n.isOptional()&&t.push(e)}),t.length>15)throw new Error('Too many optional arguments. "'+t.length+'" optionals would generate  '+Math.pow(2,t.length)+" optional sequences.");var n=u(t);n.forEach(function(t){var n=f.slice();t.forEach(function(t,e){n.splice(t-e,1)}),p.push(n)})}function l(t,n){var o=n.getSegments(),i={};return f.forEach(function(n){if(n.isParameter()){var e=t.indexOf(n);e>=0?i[n.getName()]=n.getValue(o[e]):i[n.getName()]=n.getValue()}}),e({route:r,url:n,values:i})}var f,d,p;i.initialize=function(n){i.super(),f=t(n.pattern,n.options),d=n.options&&n.options.ignoreTrailingSegments||!1,p=[],s()},i.events=n.eventCategory(),r.onMatched=i.events.createEvent("matched"),r.on=i.events.on,r.matchUrl=function(t){var n=c(t);if(!n)return e.routeNoMatchResult;var r=l(n,t);return i.events.trigger("matched",r),r},r.expand=function(t){t=t||{};var n=[];f.forEach(function(e){var r;if(r=e.isParameter()?t[e.getName()]:e.getValue(),void 0!==r||!e.isOptional()){if(!e.match(r))throw new Error("Could not generate a valid URL");n.push(r)}});var e={};return Object.keys(t).forEach(function(n){r.hasParameter(n)||(e[n]=t[n],e[n]instanceof Array&&(e[n]=e[n].join(",")))}),o.build(n.join("/"),e).toString()},r.hasParameter=function(t){return f.some(function(n){return n.isParameter()&&n.getName()===t})},r.toString=function(){return"route("+f.join("/")+")"}});return a}),r("router/hashLocation",["jquery","../events","./url","klassified"],function(t,n,e,r){var o=!("onhashchange"in window),i=25,u=r.subclass(function(r,u){function a(){return window.location.hash}function c(t){window.location.hash=t}function s(t){return"string"==typeof t&&(t=e({rawUrl:t})),"#!/"+t.toString()}function l(t){return e({rawUrl:t.replace(/^#!?[\/]?/,"")})}function f(t){t=t||a(),u.currentHash!==t&&(u.currentHash=t,u.history.push(u.currentHash)),r.onChanged.trigger(l(u.currentHash))}function d(){var t=a(),n=u.currentHash!==t;n&&f(t)}var p=null;u.currentHash=void 0,u.history=[],u.events=n.eventCategory(),r.onChanged=u.events.createEvent("changed"),r.setUrl=function(t){var n=s(t);c(n),f(n)},r.getUrl=function(){return l(a())},r.linkToUrl=function(t){return s(t)},r.back=function(t){r.isHistoryEmpty()?t&&c(s(t)):(u.history.pop(),c(u.history.pop())),f()},r.isHistoryEmpty=function(){return u.history.length<=1},r.start=function(){r.stop(),u.currentHash=a(),u.history=[u.currentHash],o?p=setInterval(d,i):t(window).bind("hashchange",d)},r.stop=function(){p&&(clearInterval(p),p=null),t(window).unbind("hashchange",d)}});return u}),r("router/router",["jquery","../events","./route","./url","./hashLocation","klassified"],function(t,n,e,r,o,i){var u=function(){return u.instance||(u.instance=o()),u.instance},a=i.subclass(function(t,o){function i(){var t=Array.prototype.slice.call(arguments),n={};return t.forEach(function(t){Object.keys(t).forEach(function(e){n[e]=t[e]})}),n}o.initialize=function(t){o.super(t),o.location=t.locationHandler||u(),o.routeTable=[],o.lastMatch=void 0,o.defaultParameters={},o.location.onChanged(function(){o.resolveUrl()})},o.events=n.eventCategory(),t.onRouteMatched=o.events.createEvent("routeMatched"),t.onRouteNotFound=o.events.createEvent("routeNotFound"),t.onResolveUrl=o.events.createEvent("resolveUrl"),t.on=o.events.on,t.resolveUrl=function(t){"string"==typeof t&&(t=r({rawUrl:t})),o.resolveUrl(t)},t.addRoute=function(t){t=t||{};var n=e({pattern:t.pattern,options:t});return t.action&&n.onMatched(function(n){t.action.apply(this,n.getActionArguments())}),n.name=t.name,n.fallThrough=t.fallThrough,n.priority=t.priority,o.addRoute(n),n},t.findRoute=function(t){for(var n=o.routeTable.length,e=0;e<n;e++){var r=o.routeTable[e];if(t(r))return r}return null},t.getRouteByName=function(n){return t.findRoute(function(t){return t.name&&t.name===n})},t.removeRoute=function(t){var n=o.routeTable.indexOf(t);if(n===-1)throw new Error("Route not in route table");o.routeTable.splice(n,1)},t.clear=function(){o.routeTable=[],o.lastMatch=void 0},t.pipeRoute=function(n,e){if(!n||!n.pattern)throw new Error("Route pattern required");var r=t.addRoute(n);return r.onMatched(function(t){e.resolveUrl(t.getUrl())}),r},t.pipeNotFound=function(n){return t.onRouteNotFound(function(t){n.resolveUrl(t)})},t.getUrl=function(){return o.location.getUrl()},t.linkTo=function(n,e,r){var i=t.getRouteByName(n);return i?o.location.linkToUrl(t.expand({routeName:i.name,parameters:e,excludeCurrentParameters:!r})):t.linkToPath(n,e)},t.linkToPath=function(n,e){return t.linkToUrl(r.build(n,e))},t.linkToUrl=function(t){return o.location.linkToUrl(t)},t.redirectTo=function(n,e,r){var i=t.getRouteByName(n);return i?o.location.setUrl(t.expand({routeName:i.name,parameters:e,excludeCurrentParameters:!r})):t.redirectToPath(n,e)},t.redirectToPath=function(n,e){return t.redirectToUrl(r.build(n,e))},t.redirectToUrl=function(t){return o.location.setUrl(t)},t.expand=function(n){var u,a=n.routeName,c=n.parameters||{},s=n.excludeCurrentParameters||!1;u=a?t.getRouteByName(a)||e():o.lastMatch?o.lastMatch.getRoute():e();var l=s?{}:t.getParameters(),f=i(l,c);Object.keys(o.defaultParameters).forEach(function(t){t in f||(f[t]="function"==typeof o.defaultParameters[t]?o.defaultParameters[t]():o.defaultParameters[t])});var d=u.expand(f);return r({rawUrl:d})},t.linkToParameters=function(n,e){return o.location.linkToUrl(t.expand({parameters:n,excludeCurrentParameters:e}))},t.setParameters=function(n,e){t.redirectToUrl(t.expand({parameters:n,excludeCurrentParameters:e}))},t.getParameters=function(){return o.lastMatch?o.lastMatch.getParameters():o.location.getUrl().getQuery()},t.getParameter=function(n){var e=t.getParameters();return e[n]},t.setDefaultParameter=function(t,n){o.defaultParameters[t]=n},t.back=function(t){return o.location.back(t)},t.isHistoryEmpty=function(){return o.location.isHistoryEmpty()},t.start=function(){o.location.start(),o.resolveUrl()},t.stop=function(){o.location.stop()},o.resolveUrl=function(n){var e=void 0===n?o.location.getUrl():n;t.onResolveUrl.trigger(e);var r=0;o.routeTable.some(function(n){var i=e.matchRoute(n);return!(!i.isMatch()||(o.lastMatch=i,r++,t.onRouteMatched.trigger(i),void 0!==n.fallThrough&&n.fallThrough!==!1))||null}),0===r&&t.onRouteNotFound.trigger(e.toString())},o.addRoute=function(t){var n=o.routeTable.length;if(void 0!==t.priority){do--n;while(o.routeTable[n]&&(void 0===o.routeTable[n].priority||t.priority<o.routeTable[n].priority));n+=1}o.routeTable.splice(n,0,t)}});return a}),r("router",["./router/url","./router/route","./router/router"],function(t,n,e){var r=e();return{url:t,route:n,router:e,getRouter:function(){return r},setRouter:function(t){r=t}}}),r("widget",["klassified","./widget-extensions","./router","./events","./htmlCanvas","jquery"],function(t,n,e,r,o,i){function u(){return!!s.get()}function a(t,n){var e=s.get();try{s.set(n),t()}finally{s.set(e)}}var c=function(){var t={},n=0;return t.newId=function(){return n+=1,n.toString()},t}(),s=function(){var t;return{get:function(){return t},set:function(n){t=n}}}(),l=t.subclass(function(t,l){function f(n){l.withChildrenRegistration(function(){t.renderOn(n)})}var d,p;l.initialize=function(t){l.super(t),p=t.id||c.newId(),l.inUpdateTransaction=!1,d=[]},l.events=r.eventCategory(),t.onAttach=l.events.createEvent(),t.onDetach=l.events.createEvent(),t.getId=function(){return p},t.id=t.getId,t.dispose=function(){d.forEach(function(t){t.dispose()}),l.dispose(),l.events.dispose()},t.willDetach=function(){d.forEach(function(t){t.willDetach()}),l.willDetach(),t.onDetach.trigger()},t.appendTo=function(t){l.withAttachHooks(function(){f(o(t))})},t.replace=function(t){l.withAttachHooks(function(){var n=o(t);n.root.asJQuery().empty(),f(n)})},t.asJQuery=function(){return i("#"+t.getId())},t.isRendered=function(){return t.asJQuery().length>0},t.appendToBrush=function(t){l.withAttachHooks(function(){f(o(t.asJQuery()))})},t.triggerWillAttach=function(){l.willAttach(),d.forEach(function(t){t.triggerWillAttach()})},t.triggerDidAttach=function(){l.didAttach(),d.forEach(function(t){t.triggerDidAttach()}),t.onAttach.trigger()},l.withAttachHooks=function(n){var e=u();e||t.triggerWillAttach(),n(),e||t.triggerDidAttach()},t.on=l.events.on,t.onceOn=l.events.onceOn,t.off=l.events.off,t.trigger=l.events.trigger,l.nextId=function(){return c.newId()},l.dispose=function(){},l.router=e.getRouter(),l.linkTo=l.router.linkTo,l.linkToPath=l.router.linkToPath,l.linkToUrl=l.router.linkToUrl,l.redirectTo=l.router.redirectTo,l.redirectToPath=l.router.redirectToPath,l.redirectToUrl=l.router.redirectToUrl,l.getParameters=l.router.getParameters,l.getParameter=l.router.getParameter,l.setParameters=l.router.setParameters,t.renderOn=function(n){l.renderRootOn(n).render(t.renderContentOn)},l.withChildrenRegistration=function(n){var e=s.get();e&&e.registerChild(t),a(function(){d=[],n()},t)},t.registerChild=function(t){d.push(t)},l.renderRootOn=function(t){return t.tag("widgetjs-widget").id(p)},t.renderContentOn=function(t){},l.willAttach=function(){},l.didAttach=function(){},l.willDetach=function(){},l.willUpdate=function(){},t.update=function(){!l.inUpdateTransaction&&t.isRendered()&&(l.willUpdate(),l.withAttachHooks(function(){var n=o();f(n),t.asJQuery().replaceWith(n.root.element)}))},t.withinTransaction=function(t,n){if(l.inUpdateTransaction)t();else try{l.inUpdateTransaction=!0,t()}finally{l.inUpdateTransaction=!1,n&&n()}},t.withUpdate=function(n){t.withinTransaction(n,t.update)},t.withNoUpdate=function(n){t.withinTransaction(n)};for(var h in n)n.hasOwnProperty(h)&&(l[h]=n[h]);return t});return l}),r("core",["./htmlCanvas","./widget","./widget-extensions","./router","./events"],function(t,n,e,r,o){return{htmlCanvas:t,widget:n,ext:e,router:r,events:o}}),e(["core"]),e("widgetjs")});