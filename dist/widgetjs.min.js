/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(e,t){typeof define=="function"&&define.amd?define(["jquery"],t):e.widgetjs=t(e.$)})(this,function(e){var t,n,r;return function(e){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(t){if(v(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!v(a,t)&&!v(c,t))throw new Error("No "+t);return a[t]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(t,n,r,i){var s,l,h,p,d,m=[],y=typeof r,E;i=i||t;if(y==="undefined"||y==="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(d=0;d<n.length;d+=1){p=o(n[d],i),l=p.f;if(l==="require")m[d]=u.require(t);else if(l==="exports")m[d]=u.exports(t),E=!0;else if(l==="module")s=m[d]=u.module(t);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=r?r.apply(a[t],m):undefined;if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!E)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){if(typeof t=="string")return u[t]?u[t](n):w(o(t,n).f);if(!t.splice){l=t,l.deps&&s(l.deps,l.callback);if(!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s},s.config=function(e){return s(e)},t._defined=a,r=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}}(),r("htmlCanvas",["jquery"],function(e){function s(e){var n=o({element:e}),i={};return i.root=n,i.tag=function(e,t){var r=o({tag:e,children:t});return n.appendBrush(r),r},t.forEach(function(e){i[e]=function(){var t=Array.prototype.slice.call(arguments);return i.tag(e,t)}}),i.omit=function(){return r},i.render=function(){var e=Array.prototype.slice.call(arguments);n.render(e)},i.raw=function(e){n.raw(e)},i.renderNonBreaking=function(e){i.raw(e.replace(/\s/g,"&nbsp;"))},i}function o(t){function a(e){return document.createElement(e)}function f(t){if(typeof t=="undefined"||t===null)throw new Error("cannot append null or undefined to brush");if(t===r)return;if(typeof t=="object"&&t.constructor===Array)for(var n=0;n<t.length;n++)f(t[n]);else typeof t=="string"?h(t):typeof t=="function"?p(t):typeof t=="object"&&t.appendToBrush?t.appendToBrush(o):typeof t=="object"?o.attr(t):e(u).append(t)}function l(e){u.canHaveChildren!==!1?u.appendChild(e):u.text=u.text+e.innerHTML}function c(e){l(e.element())}function h(t){e(u).append(document.createTextNode(t))}function p(e){var t=s(o);e(t)}function d(t){return typeof t=="undefined"||t===null?e(document.createDocumentFragment()).get(0):typeof t=="object"&&t.asJQuery?t.asJQuery().get(0):e(t).get(0)}var o={},u=t.tag?a(t.tag):d(t.element);if(!u)throw new Error("htmlTagBrush requires an element");return o.element=function(){return u},o.render=function(){var e=Array.prototype.slice.call(arguments);for(var t=0;t<e.length;t++)f(e[t]);return o},o.appendToBrush=function(e){e.appendBrush(o)},o.appendBrush=c,o.html=function(e){return o.asJQuery().html(e),o},o.raw=function(e){return o.asJQuery().append(e),o},o.renderNonBreaking=function(e){o.raw(e.replace(/\s/g,"&nbsp;"))},o.on=function(e,t){return o.asJQuery().bind(e,t),o},i.forEach(function(e){o[e]=function(t){return o.on(e,t)}}),o.setAttribute=function(e,t){return t===r?o:(u.setAttribute(e,t),o)},n.forEach(function(e){o[e]=function(t){return o.setAttribute(e,t)}}),o.css=function(e,t){return typeof e=="string"?o.asJQuery().css(e,t):o.asJQuery().css(e),o},o.attr=function(e){for(var t in e)e.hasOwnProperty(t)&&(typeof e[t]=="function"?o.on(t,e[t]):t==="klass"?o.addClass(e[t]):o.setAttribute(t,e[t]));return o},o.addClass=function(e){return o.asJQuery().addClass(e),o},o.removeClass=function(e){return o.asJQuery().removeClass(e),o},o.asJQuery=function(){return e(o.element())},t.children&&f(t.children),o}var t="a abbr acronym address area article aside audio b bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn div dl dt em embed fieldset figcaption figure footer form frame frameset h1 h2 h3 h4 h5 h6 hr head header hgroup html i iframe img input ins kbd keygen label legend li link map mark meta meter nav noscript object ol optgroup option output p param pre progress q rp rtruby samp script section select small source span strong style sub summarysup table tbody td textarea tfoot th thead time title tr track tt ul varvideo wbr".split(" "),n="href for id media rel src style title type".split(" "),r={},i="blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error dragstart dragenter dragover dragleave drop dragend".split(" ");return s}),r("klassified",[],function(){function e(t,n){t=t||{},n=n||{};var r={};return r.getClass=function(){return e},n.initialize=function(){},n.subclassResponsibility=o,n.get=function(e,t){t||(t=function(){return n[e]}),r["get"+s(e)]=t},n.set=function(e,t){t||(t=function(t){return n[e]=t,t}),r["set"+s(e)]=t},r.getClass().extensions.forEach(function(e){e(r,n)}),r}function n(e,n){Object.keys(e).forEach(function(r){if(typeof n[r]=="function"&&typeof e[r]=="function"&&t.test(e[r])&&!e[r].superInstalled){var i=n[r];e[r]=function(t,n){return function(){var t=e.super;e.super=i;var r=n.apply(e,arguments);return e.super=t,e.super===undefined&&delete e.super,r}}(r,e[r]),e[r].superInstalled=!0}})}function r(e){throw new Error("Cannot instantiate an instance of an abstract class")}function i(e){throw new Error("Cannot create new instances of a singleton class, use `instance` instead.")}function s(e){return e[0].toUpperCase()+e.slice(1)}function o(){throw new Error("Subclass responsibility")}e.subclasses=[],e.allSubclasses=function(){var e=this.subclasses.slice();return this.subclasses.forEach(function(t){t.allSubclasses().forEach(function(t){e.push(t)})}),e},e.subclassResponsibility=o,e.extensions=[];var t=/\bsuper\b/;return e.subclass=function(e){function o(u,a,f){u=u||{},a=a||{},o.isAbstract&&!f&&r(s),o.isSingleton&&!f&&i(s);var l=s(u,a,!0);l.getClass=function(){return o};var c=Object.assign({},l),h=Object.assign({},a);return o.extensions.forEach(function(e){e(l,a)}),e(l,a),t.test(e)&&(n(l,c),n(a,h)),f||a.initialize(u),l}var s=this;return o.superclass=s,o.subclasses=[],s.subclasses.push(o),o.classBuilder=s.classBuilder,o.classBuilder(o),o},e.singletonSubclass=function(e){var t=this.subclass(e),n=t();return t.isSingleton=!0,t.instance=function(){return n},t},e.abstractSubclass=function(e){var t=this.subclass(e);return t.isAbstract=!0,t},e.class=function(t){var n=this;if(n===e)throw new Error("object class should not be extended.");var r=n.classBuilder;n.classBuilder=function(e){r(e),t(e)},n.classBuilder(n)},e.classBuilder=function(t){t.class=e.class,t.subclass=e.subclass,t.singletonSubclass=e.singletonSubclass,t.abstractSubclass=e.abstractSubclass,t.allSubclasses=e.allSubclasses,t.subclassResponsibility=o,t.extend=e.extend,t.extensions=[]},e.extend=function(e){this.extensions.push(e)},typeof Object.assign!="function"&&function(){Object.assign=function(e){if(e===undefined||e===null)throw new TypeError("Cannot convert undefined or null to object");var t=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r!==undefined&&r!==null)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}}(),e}),r("widget-extensions",[],function(){return{}}),r("router/url",["klassified"],function(e){function r(e){return e.split(t).filter(Boolean)}function i(e){return e.replace(/\?.*$/g,"")}function s(e){var t=/[^?]*\?(.*)$/g.exec(e),n={},r;return t&&t.length>=2&&t[1].split("&").forEach(function(e){r=e.split("="),n[r[0]]=r[1]}),n}var t="/",n=e.subclass(function(e,t){var n,o,u,a;t.initialize=function(e){t.super(e),n=e.rawUrl||"",o=i(n),u=s(n),a=r(o)},e.getPath=function(){return o},e.getQuery=function(){return u},e.getSegments=function(){return a},e.matchRoute=function(t){return t.matchUrl(e)},e.toString=function(){return n}});return n.build=function(e,t){if(typeof e=="undefined"||e===null||typeof e!="string")throw"accepts only string paths";if(t){var r=decodeURIComponent(jQuery.param(t));if(r)return n({rawUrl:e+"?"+r})}return n({rawUrl:e})},n}),r("router/abstractSegment",["klassified"],function(e){var t=e.subclass(function(e,t){t.initialize=function(e){t.super(e),t.segmentString=e.segmentString,t.options=e.options||{}},e.match=function(e){return!1},e.getValue=function(e){return t.segmentString},e.isParameter=function(){return!1},e.isOptional=function(){return!1},e.toString=function(){return t.segmentString}});return t.class(function(e){e.match=function(e){return!1}}),t}),r("router/parameterSegment",["./abstractSegment"],function(e){function t(e){if(typeof e=="function")return e;if(e instanceof RegExp){var t=new RegExp(e);return function(e){return t.test(e)}}if(Object.prototype.toString.call(e)==="[object Array]"){var n=e.map(function(e){return e.toLowerCase()});return function(e){var t=e.toLowerCase();return n.indexOf(t)!==-1}}}var n=e.subclass(function(e,n){n.initialize=function(e){n.super(e),n.name=n.segmentString.substr(1),n.constraints=n.options.constraints&&n.options.constraints[n.name]&&[n.options.constraints[n.name]]||[],n.validators=n.constraints.map(t).filter(Boolean)},e.getName=function(){return n.name},e.getValue=function(e){return e},e.isParameter=function(){return!0},e.match=function(t){return t!==undefined&&e.validate(t)},e.validate=function(e){return n.validators.every(function(t){return t(e)})},e.toString=function(){return"param("+e.getName()+")"}});return n.class(function(e){e.match=function(e){return e.substr(0,1)==="#"}}),n}),r("router/optionalParameterSegment",["./parameterSegment"],function(e){var t=e.subclass(function(e,t){t.initialize=function(e){t.super(e),t.defaultValue=t.options.defaults&&t.options.defaults[t.name]},e.getValue=function(e){return e===undefined?t.defaultValue:e},e.isOptional=function(){return!0},e.toString=function(){return"optional("+e.getName()+")"}});return t.class(function(e){e.match=function(e){return e.substr(0,1)==="?"}}),t}),r("router/staticSegment",["./abstractSegment"],function(e){var t=e.subclass(function(e,t){return e.match=function(t){return e.getValue()===t},e});return t.class(function(e){e.match=function(e){return["#","?"].indexOf(e[0])===-1}}),t}),r("router/routeFactory",["./parameterSegment","./optionalParameterSegment","./staticSegment","./abstractSegment"],function(e,t,n,r){function s(e,t){if(!e)return[];t=t||{};var n=e.split(i),r=n.map(Function.prototype.call,String.prototype.trim).filter(Boolean),s=r.map(function(e){return o(e,t)});return s}function o(e,t){t=t||{};var n=r.allSubclasses();for(var i=0;i<n.length;i++){var s=n[i];if(s.match(e))return s({segmentString:e,options:t})}return null}var i="/";return s}),r("events",[],function(){var e=function(e,t){function s(e){var t=n({callback:e,event:r});return i.push(t),t}t=t||{};var r=function(e){return s(e)},i=[];return r.on=function(e){return s(e)},r.onceOn=function(e){var s=n({callback:function(){t.remove(s),e.apply(r,arguments)}});return i.push(s),s},r.off=function(e){t.remove(e)},r.trigger=function(){var e=Array.prototype.slice.call(arguments);i.forEach(function(t){t.execute(e)})},r.dispose=function(){i.slice().forEach(function(e){e.unbind()})},t.push=function(e){i.push(e),e.bind(r)},t.remove=function(e){i.splice(i.indexOf(e),1)},r},t=function(){function i(t){return s(t)||o(e(),t),n[t]}function s(e){return n[e]!==undefined}function o(e,t){return r.push(e),t&&(n[t]=e),e}var t={},n={},r=[];return t.createEvent=function(t){return o(e(),t)},t.on=function(e,t){return i(e).on(t)},t.off=function(e,t){return i(e).off(t)},t.onceOn=function(e,t){return i(e).onceOn(t)},t.trigger=function(e){var n=Array.prototype.slice.call(arguments,1),r=i(e);r.trigger.apply(t,n)},t.dispose=function(){r.forEach(function(e){e.dispose()}),n={},r=[]},t},n=function(e){e=e||{};var t={},n=e.callback,r=e.event;return t.isBound=function(){return r!==undefined},t.unbind=function(){t.isBound()&&(r.off(t),r=undefined)},t.bind=function(e){t.unbind(),e&&(r=e)},t.execute=function(e){n&&n.apply(t,e)},t},r=function(){var e={},n={};return e.register=function(e){if(n[e])throw"A event category is already registered for "+e;return n[e]=t(),n[e]},e.at=function(t){return n[t]||e.register(t),n[t]},e}();return r.eventCategory=t,r.eventhandler=t,r.event=e,r}),r("router/routeMatchResult",["klassified"],function(e){var t=e.subclass(function(e,t){function u(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}var n,r,i,s,o;t.initialize=function(e){t.super(e),n=e.url,r=e.route,i=n&&n.getQuery&&n.getQuery()||{},s=e.values||{},o=u(s,i)},e.getRoute=function(){return r},e.getUrl=function(){return n},e.isMatch=function(){return!0},e.getRouteParameters=function(){return s},e.getQueryParameters=function(){return n.getQuery()},e.getParameters=function(){return o},e.getActionArguments=function(){var e=Object.keys(s).map(function(e){return s[e]});return e.push(n.getQuery()),e}});return t.class(function(e){e.routeNoMatchResult=function(){var t=e();return t.isMatch=function(){return!1},t}()}),t}),r("router/route",["./routeFactory","../events","./routeMatchResult","jquery","./url","klassified"],function(e,t,n,r,s,o){function a(e){var t=[],n,r,s=Math.pow(2,e.length);for(r=1;r<s;r++){n=[],i=e.length-1;do(r&1<<i)!==0&&n.unshift(e[i]);while(i--);t.unshift(n)}return t}var u=o.subclass(function(r,i){function l(e,t){return t=t||o,e.length!=t.length&&!u?!1:t.every(function(t,n){var r=e[n];return r!==undefined&&t.match(r)})}function c(e){var t=e.getSegments();if(l(t))return o;var n;for(n=0;n<f.length;n++)if(l(t,f[n]))return f[n];return null}function h(){var e=[];o.forEach(function(t,n){t.isOptional()&&e.push(n)});if(e.length>15)throw new Error('Too many optional arguments. "'+e.length+'"" optionals would generate  '+Math.pow(2,e.length)+" optional sequences.");var t=a(e);t.forEach(function(e){var t=o.slice();e.forEach(function(e,n){t.splice(e-n,1)}),f.push(t)})}function p(e,t){var i=t.getSegments(),s={};return o.forEach(function(t){if(!t.isParameter())return;var n=e.indexOf(t);n>=0?s[t.getName()]=t.getValue(i[n]):s[t.getName()]=t.getValue()}),n({route:r,url:t,values:s})}var o,u,f;i.initialize=function(t){i.super(),o=e(t.pattern,t.options),u=t.options&&t.options.ignoreTrailingSegments||!1,f=[],h()},i.events=t.eventCategory(),r.onMatched=i.events.createEvent("matched"),r.on=i.events.on,r.matchUrl=function(e){var t=c(e);if(!t)return n.routeNoMatchResult;var r=p(t,e);return i.events.trigger("matched",r),r},r.expand=function(e){e=e||{};var t=[];o.forEach(function(n){var r;n.isParameter()?r=e[n.getName()]:r=n.getValue();if(r===undefined&&n.isOptional())return;if(!n.match(r))throw new Error("Could not generate a valid URL");t.push(r)});var n={};return Object.keys(e).forEach(function(t){r.hasParameter(t)||(n[t]=e[t],n[t]instanceof Array&&(n[t]=n[t].join(",")))}),s.build(t.join("/"),n).toString()},r.hasParameter=function(e){return o.some(function(t){return t.isParameter()&&t.getName()===e})},r.toString=function(){return"route("+o.join("/")+")"}});return u}),r("router/hashLocation",["jquery","../events","./url","klassified"],function(e,t,n,r){var i=!("onhashchange"in window),s=25,o=r.subclass(function(r,o){function a(){return window.location.hash}function f(e){window.location.hash=e}function l(e){return typeof e=="string"&&(e=n({rawUrl:e})),"#!/"+e.toString()}function c(e){return n({rawUrl:e.replace(/^#!?[\/]?/,"")})}function h(e){e=e||a(),o.currentHash!==e&&(o.currentHash=e,o.history.push(o.currentHash)),r.onChanged.trigger(c(o.currentHash))}function p(){var e=a(),t=o.currentHash!==e;t&&h(e)}var u=null;o.currentHash=undefined,o.history=[],o.events=t.eventCategory(),r.onChanged=o.events.createEvent("changed"),r.setUrl=function(e){var t=l(e);f(t),h(t)},r.getUrl=function(){return c(a())},r.linkToUrl=function(e){return l(e)},r.back=function(e){r.isHistoryEmpty()?e&&f(l(e)):(o.history.pop(),f(o.history.pop())),h()},r.isHistoryEmpty=function(){return o.history.length<=1},r.start=function(){r.stop(),o.currentHash=a(),o.history=[o.currentHash],i?u=setInterval(p,s):e(window).bind("hashchange",p)},r.stop=function(){u&&(clearInterval(u),u=null),e(window).unbind("hashchange",p)}});return o}),r("router/router",["jquery","../events","./route","./url","./hashLocation","klassified"],function(e,t,n,r,i,s){var o=function(){return o.instance||(o.instance=i()),o.instance},u=s.subclass(function(e,i){function s(){var e=Array.prototype.slice.call(arguments),t={};return e.forEach(function(e){Object.keys(e).forEach(function(n){t[n]=e[n]})}),t}i.initialize=function(e){i.super(e),i.location=e.locationHandler||o(),i.routeTable=[],i.lastMatch=undefined,i.defaultParameters={},i.location.onChanged(function(){i.resolveUrl()})},i.events=t.eventCategory(),e.onRouteMatched=i.events.createEvent("routeMatched"),e.onRouteNotFound=i.events.createEvent("routeNotFound"),e.onResolveUrl=i.events.createEvent("resolveUrl"),e.on=i.events.on,e.resolveUrl=function(e){typeof e=="string"&&(e=r({rawUrl:e})),i.resolveUrl(e)},e.addRoute=function(e){e=e||{};var t=n({pattern:e.pattern,options:e});return e.action&&t.onMatched(function(t){e.action.apply(this,t.getActionArguments())}),t.name=e.name,t.fallThrough=e.fallThrough,t.priority=e.priority,i.addRoute(t),t},e.findRoute=function(e){var t=i.routeTable.length;for(var n=0;n<t;n++){var r=i.routeTable[n];if(e(r))return r}return null},e.getRouteByName=function(t){return e.findRoute(function(e){return e.name&&e.name===t})},e.removeRoute=function(e){var t=i.routeTable.indexOf(e);if(t===-1)throw new Error("Route not in route table");i.routeTable.splice(t,1)},e.clear=function(){i.routeTable=[],i.lastMatch=undefined},e.pipeRoute=function(t,n){if(!t||!t.pattern)throw new Error("Route pattern required");var r=e.addRoute(t);return r.onMatched(function(e){n.resolveUrl(e.getUrl())}),r},e.pipeNotFound=function(t){return e.onRouteNotFound(function(e){t.resolveUrl(e)})},e.getUrl=function(){return i.location.getUrl()},e.linkTo=function(t,n,r){var s=e.getRouteByName(t);return s?i.location.linkToUrl(e.expand({routeName:s.name,parameters:n,excludeCurrentParameters:!r})):e.linkToPath(t,n)},e.linkToPath=function(t,n){return e.linkToUrl(r.build(t,n))},e.linkToUrl=function(e){return i.location.linkToUrl(e)},e.redirectTo=function(t,n,r){var s=e.getRouteByName(t);return s?i.location.setUrl(e.expand({routeName:s.name,parameters:n,excludeCurrentParameters:!r})):e.redirectToPath(t,n)},e.redirectToPath=function(t,n){return e.redirectToUrl(r.build(t,n))},e.redirectToUrl=function(e){return i.location.setUrl(e)},e.expand=function(t){var o=t.routeName,u=t.parameters||{},a=t.excludeCurrentParameters||!1,f;o?f=e.getRouteByName(o)||n():i.lastMatch?f=i.lastMatch.getRoute():f=n();var l=a?{}:e.getParameters(),c=s(l,u);Object.keys(i.defaultParameters).forEach(function(e){e in c||(c[e]=typeof i.defaultParameters[e]=="function"?i.defaultParameters[e]():i.defaultParameters[e])});var h=f.expand(c);return r({rawUrl:h})},e.linkToParameters=function(t,n){return i.location.linkToUrl(e.expand({parameters:t,excludeCurrentParameters:n}))},e.setParameters=function(t,n){e.redirectToUrl(e.expand({parameters:t,excludeCurrentParameters:n}))},e.getParameters=function(){return i.lastMatch?i.lastMatch.getParameters():i.location.getUrl().getQuery()},e.getParameter=function(t){var n=e.getParameters();return n[t]},e.setDefaultParameter=function(e,t){i.defaultParameters[e]=t},e.back=function(e){return i.location.back(e)},e.isHistoryEmpty=function(){return i.location.isHistoryEmpty()},e.start=function(){i.location.start(),i.resolveUrl()},e.stop=function(){i.location.stop()},i.resolveUrl=function(t){var n=t===undefined?i.location.getUrl():t;e.onResolveUrl.trigger(n);var r=0;i.routeTable.some(function(t){var s=n.matchRoute(t);if(s.isMatch()){i.lastMatch=s,r++,e.onRouteMatched.trigger(s);if(t.fallThrough===undefined||t.fallThrough===!1)return!0}}),r===0&&e.onRouteNotFound.trigger(n.toString())},i.addRoute=function(e){var t=i.routeTable.length;if(e.priority!==undefined){do--t;while(i.routeTable[t]&&(i.routeTable[t].priority===undefined||e.priority<i.routeTable[t].priority));t+=1}i.routeTable.splice(t,0,e)}});return u}),r("router",["./router/url","./router/route","./router/router"],function(e,t,n){var r=n();return{url:e,route:t,router:n,getRouter:function(){return r},setRouter:function(e){r=e}}}),r("widget",["klassified","./widget-extensions","./router","./events","./htmlCanvas","jquery"],function(e,t,n,r,i,s){function f(){return!!a.get()}function l(e,t){var n=a.get();try{a.set(t),e()}finally{a.set(n)}}var o=e.subclass(function(e,o){function p(t){o.withChildrenRegistration(function(){e.renderOn(t)})}var c,h;o.initialize=function(e){o.super(e),h=e.id||u.newId(),o.inUpdateTransaction=!1,c=[]},o.events=r.eventCategory(),e.onAttach=o.events.createEvent(),e.onDetach=o.events.createEvent(),e.getId=function(){return h},e.id=e.getId,e.dispose=function(){c.forEach(function(e){e.dispose()}),o.dispose(),o.events.dispose()},e.willDetach=function(){c.forEach(function(e){e.willDetach()}),o.willDetach(),e.onDetach.trigger()},e.appendTo=function(e){o.withAttachHooks(function(){p(i(e))})},e.replace=function(e){o.withAttachHooks(function(){var t=i(e);t.root.asJQuery().empty(),p(t)})},e.asJQuery=function(){return s("#"+e.getId())},e.isRendered=function(){return e.asJQuery().length>0},e.appendToBrush=function(e){o.withAttachHooks(function(){p(i(e.asJQuery()))})},e.triggerWillAttach=function(){o.willAttach(),c.forEach(function(e){e.triggerWillAttach()})},e.triggerDidAttach=function(){o.didAttach(),c.forEach(function(e){e.triggerDidAttach()}),e.onAttach.trigger()},o.withAttachHooks=function(t){var n=f();n||e.triggerWillAttach(),t(),n||e.triggerDidAttach()},e.on=o.events.on,e.onceOn=o.events.onceOn,e.off=o.events.off,e.trigger=o.events.trigger,o.nextId=function(){return u.newId()},o.dispose=function(){},o.router=n.getRouter(),o.linkTo=o.router.linkTo,o.linkToPath=o.router.linkToPath,o.linkToUrl=o.router.linkToUrl,o.redirectTo=o.router.redirectTo,o.redirectToPath=o.router.redirectToPath,o.redirectToUrl=o.router.redirectToUrl,o.getParameters=o.router.getParameters,o.getParameter=o.router.getParameter,o.setParameters=o.router.setParameters,e.renderOn=function(t){o.renderRootOn(t).render(e.renderContentOn)},o.withChildrenRegistration=function(t){var n=a.get();n&&n.registerChild(e),l(function(){c=[],t()},e)},e.registerChild=function(e){c.push(e)},o.renderRootOn=function(e){return e.tag("widgetjs-widget").id(h)},e.renderContentOn=function(e){},o.willAttach=function(){},o.didAttach=function(){},o.willDetach=function(){},o.willUpdate=function(){},e.update=function(){if(o.inUpdateTransaction||!e.isRendered())return;o.willUpdate(),o.withAttachHooks(function(){var t=i();p(t),e.asJQuery().replaceWith(t.root.element)})},e.withinTransaction=function(e,t){if(o.inUpdateTransaction)e();else try{o.inUpdateTransaction=!0,e()}finally{o.inUpdateTransaction=!1,t&&t()}},e.withUpdate=function(t){e.withinTransaction(t,e.update)},e.withNoUpdate=function(t){e.withinTransaction(t)};for(var d in t)t.hasOwnProperty(d)&&(o[d]=t[d]);return e}),u=function(){var e={},t=0;return e.newId=function(){return t+=1,t.toString()},e}(),a=function(){var e;return{get:function(){return e},set:function(t){e=t}}}();return o}),r("core",["./htmlCanvas","./widget","./widget-extensions","./router","./events"],function(e,t,n,r,i){return{htmlCanvas:e,widget:t,ext:n,router:r,events:i}}),r("jquery",function(){return e}),n("core")});