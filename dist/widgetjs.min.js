/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,e){"function"==typeof define&&define.amd?define("widgetjs",["jquery","klassified"],e):t.widgetjs=e(t.$,t.klassified)}(this,function(t,e){var n,r,o;return function(t){function e(t,e){return w.call(t,e)}function i(t,e){var n,r,o,i,u,a,c,s,f,l,d,p=e&&e.split("/"),g=y.map,h=g&&g["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=t.split("/"),u=t.length-1,y.nodeIdCompat&&k.test(t[u])&&(t[u]=t[u].replace(k,"")),t=p.concat(t),f=0;f<t.length;f+=1)if(d=t[f],"."===d)t.splice(f,1),f-=1;else if(".."===d){if(1===f&&(".."===t[2]||".."===t[0]))break;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||h)&&g){for(n=t.split("/"),f=n.length;f>0;f-=1){if(r=n.slice(0,f).join("/"),p)for(l=p.length;l>0;l-=1)if(o=g[p.slice(0,l).join("/")],o&&(o=o[r])){i=o,a=f;break}if(i)break;!c&&h&&h[r]&&(c=h[r],s=f)}!i&&c&&(i=c,a=s),i&&(n.splice(0,a,i),t=n.join("/"))}return t}function u(e,n){return function(){return p.apply(t,T.call(arguments,0).concat([e,n]))}}function a(t){return function(e){return i(e,t)}}function c(t){return function(e){v[t]=e}}function s(n){if(e(m,n)){var r=m[n];delete m[n],b[n]=!0,d.apply(t,r)}if(!e(v,n)&&!e(b,n))throw new Error("No "+n);return v[n]}function f(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function l(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,p,g,h,v={},m={},y={},b={},w=Object.prototype.hasOwnProperty,T=[].slice,k=/\.js$/;g=function(t,e){var n,r=f(t),o=r[0];return t=r[1],o&&(o=i(o,e),n=s(o)),o?t=n&&n.normalize?n.normalize(t,a(e)):i(t,e):(t=i(t,e),r=f(t),o=r[0],t=r[1],o&&(n=s(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},h={require:function(t){return u(t)},exports:function(t){var e=v[t];return"undefined"!=typeof e?e:v[t]={}},module:function(t){return{id:t,uri:"",exports:v[t],config:l(t)}}},d=function(n,r,o,i){var a,f,l,d,p,y,w=[],T=typeof o;if(i=i||n,"undefined"===T||"function"===T){for(r=!r.length&&o.length?["require","exports","module"]:r,p=0;p<r.length;p+=1)if(d=g(r[p],i),f=d.f,"require"===f)w[p]=h.require(n);else if("exports"===f)w[p]=h.exports(n),y=!0;else if("module"===f)a=w[p]=h.module(n);else if(e(v,f)||e(m,f)||e(b,f))w[p]=s(f);else{if(!d.p)throw new Error(n+" missing "+f);d.p.load(d.n,u(i,!0),c(f),{}),w[p]=v[f]}l=o?o.apply(v[n],w):void 0,n&&(a&&a.exports!==t&&a.exports!==v[n]?v[n]=a.exports:l===t&&y||(v[n]=l))}else n&&(v[n]=o)},n=r=p=function(e,n,r,o,i){if("string"==typeof e)return h[e]?h[e](n):s(g(e,n).f);if(!e.splice){if(y=e,y.deps&&p(y.deps,y.callback),!n)return;n.splice?(e=n,n=r,r=null):e=t}return n=n||function(){},"function"==typeof r&&(r=o,o=i),o?d(t,e,n,r):setTimeout(function(){d(t,e,n,r)},4),p},p.config=function(t){return p(t)},n._defined=v,o=function(t,n,r){n.splice||(r=n,n=[]),e(v,t)||e(m,t)||(m[t]=[t,n,r])},o.amd={jQuery:!0}}(),o("jquery",function(){return t}),o("klassified",function(){return e}),o("htmlCanvas",["jquery"],function(t){function e(t){var e=n({element:t}),o={};return o.root=e,o.tag=function(t,r){var o=n({tag:t,children:r});return e.appendBrush(o),o},r.forEach(function(t){o[t]=function(){var e=Array.prototype.slice.call(arguments);return o.tag(t,e)}}),o.omit=function(){return i},o.render=function(){var t=Array.prototype.slice.call(arguments);e.render(t)},o.raw=function(t){e.raw(t)},o.renderNonBreaking=function(t){o.raw(t.replace(/\s/g,"&nbsp;"))},o}function n(n){function r(t){return document.createElement(t)}function a(e){if("undefined"==typeof e||null===e)throw new Error("cannot append null or undefined to brush");if(e!==i)if("object"==typeof e&&e.constructor===Array)for(var n=0;n<e.length;n++)a(e[n]);else"string"==typeof e?f(e):"function"==typeof e?l(e):"object"==typeof e&&e.appendToBrush?e.appendToBrush(p):"object"==typeof e?p.attr(e):t(g).append(e)}function c(t){g.canHaveChildren!==!1?g.appendChild(t):g.text=g.text+t.innerHTML}function s(t){c(t.element())}function f(e){t(g).append(document.createTextNode(e))}function l(t){var n=e(p);t(n)}function d(e){return"undefined"==typeof e||null===e?t(document.createDocumentFragment()).get(0):"object"==typeof e&&e.asJQuery?e.asJQuery().get(0):t(e).get(0)}var p={},g=n.tag?r(n.tag):d(n.element);if(!g)throw new Error("htmlTagBrush requires an element");return p.element=function(){return g},p.render=function(){for(var t=Array.prototype.slice.call(arguments),e=0;e<t.length;e++)a(t[e]);return p},p.appendToBrush=function(t){t.appendBrush(p)},p.appendBrush=s,p.html=function(t){return p.asJQuery().html(t),p},p.raw=function(t){return p.asJQuery().append(t),p},p.renderNonBreaking=function(t){p.raw(t.replace(/\s/g,"&nbsp;"))},p.on=function(t,e){return p.asJQuery().bind(t,e),p},u.forEach(function(t){p[t]=function(e){return p.on(t,e)}}),p.setAttribute=function(t,e){return e===i?p:(g.setAttribute(t,e),p)},o.forEach(function(t){p[t]=function(e){return p.setAttribute(t,e)}}),p.css=function(t,e){return"string"==typeof t?p.asJQuery().css(t,e):p.asJQuery().css(t),p},p.attr=function(t){for(var e in t)t.hasOwnProperty(e)&&("function"==typeof t[e]?p.on(e,t[e]):"klass"===e?p.addClass(t[e]):p.setAttribute(e,t[e]));return p},p.addClass=function(t){return p.asJQuery().addClass(t),p},p.removeClass=function(t){return p.asJQuery().removeClass(t),p},p.asJQuery=function(){return t(p.element())},n.children&&a(n.children),p}var r="a abbr acronym address area article aside audio b bdi bdo big blockquote body br button canvas caption cite code col colgroup command datalist dd del details dfn div dl dt em embed fieldset figcaption figure footer form frame frameset h1 h2 h3 h4 h5 h6 hr head header hgroup html i iframe img input ins kbd keygen label legend li link map mark meta meter nav noscript object ol optgroup option output p param pre progress q rp rtruby samp script section select small source span strong style sub summarysup table tbody td textarea tfoot th thead time title tr track tt ul varvideo wbr".split(" "),o="href for id media rel src style title type".split(" "),i={},u="blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error dragstart dragenter dragover dragleave drop dragend".split(" ");return e}),o("widget-extensions",[],function(){return{}}),o("router/url",["klassified"],function(t){function e(t){return t.split(o).filter(Boolean)}function n(t){return t.replace(/\?.*$/g,"")}function r(t){var e,n=/[^?]*\?(.*)$/g.exec(t),r={};return n&&n.length>=2&&n[1].split("&").forEach(function(t){e=t.split("="),r[e[0]]=e[1]}),r}var o="/",i=t.object.subclass(function(t,o){var i,u,a,c;o.initialize=function(t){o.super(t),i=t.rawUrl||"",u=n(i),a=r(i),c=e(u)},t.getPath=function(){return u},t.getQuery=function(){return a},t.getSegments=function(){return c},t.matchRoute=function(e){return e.matchUrl(t)},t.toString=function(){return i}});return i.build=function(t,e){if("undefined"==typeof t||null===t||"string"!=typeof t)throw"accepts only string paths";if(e){var n=decodeURIComponent(jQuery.param(e));if(n)return i({rawUrl:t+"?"+n})}return i({rawUrl:t})},i}),o("router/abstractSegment",["klassified"],function(t){var e=t.object.subclass(function(t,e){e.initialize=function(t){e.super(t),e.segmentString=t.segmentString,e.options=t.options||{}},t.match=function(t){return!1},t.getValue=function(t){return e.segmentString},t.isParameter=function(){return!1},t.isOptional=function(){return!1},t.toString=function(){return e.segmentString}});return e.class(function(t){t.match=function(t){return!1}}),e}),o("router/parameterSegment",["./abstractSegment"],function(t){function e(t){if("function"==typeof t)return t;if(t instanceof RegExp){var e=new RegExp(t);return function(t){return e.test(t)}}if("[object Array]"===Object.prototype.toString.call(t)){var n=t.map(function(t){return t.toLowerCase()});return function(t){var e=t.toLowerCase();return n.indexOf(e)!==-1}}return null}var n=t.subclass(function(t,n){n.initialize=function(t){n.super(t),n.name=n.segmentString.substr(1),n.constraints=n.options.constraints&&n.options.constraints[n.name]&&[n.options.constraints[n.name]]||[],n.validators=n.constraints.map(e).filter(Boolean)},t.getName=function(){return n.name},t.getValue=function(t){return t},t.isParameter=function(){return!0},t.match=function(e){return void 0!==e&&t.validate(e)},t.validate=function(t){return n.validators.every(function(e){return e(t)})},t.toString=function(){return"param("+t.getName()+")"}});return n.class(function(t){t.match=function(t){return"#"===t.substr(0,1)}}),n}),o("router/optionalParameterSegment",["./parameterSegment"],function(t){var e=t.subclass(function(t,e){e.initialize=function(t){e.super(t),e.defaultValue=e.options.defaults&&e.options.defaults[e.name]},t.getValue=function(t){return void 0===t?e.defaultValue:t},t.isOptional=function(){return!0},t.toString=function(){return"optional("+t.getName()+")"}});return e.class(function(t){t.match=function(t){return"?"===t.substr(0,1)}}),e}),o("router/staticSegment",["./abstractSegment"],function(t){var e=t.subclass(function(t,e){return t.match=function(e){return t.getValue()===e},t});return e.class(function(t){t.match=function(t){return["#","?"].indexOf(t[0])===-1}}),e}),o("router/routeFactory",["./parameterSegment","./optionalParameterSegment","./staticSegment","./abstractSegment"],function(t,e,n,r){function o(t,e){if(!t)return[];e=e||{};var n=t.split(u),r=n.map(Function.prototype.call,String.prototype.trim).filter(Boolean),o=r.map(function(t){return i(t,e)});return o}function i(t,e){e=e||{};for(var n=r.allSubclasses(),o=0;o<n.length;o++){var i=n[o];if(i.match(t))return i({segmentString:t,options:e})}return null}var u="/";return o}),o("events",[],function(){var t=function(t,e){function n(t){var e=i({callback:t,event:r});return o.push(e),e}e=e||{};var r=function(t){return console.warn("Using an event as a function is deprecated. Send on() to the event instead."),n(t)},o=[];r.on=function(t){return n(t)};var i=function(t){t=t||{};var e={},n=t.callback,r=t.event;return e.isBound=function(){return void 0!==r},e.unbind=function(){e.isBound()&&(r.off(e),r=void 0)},e.bind=function(t){e.unbind(),t&&(r=t)},e.execute=function(t){n&&n.apply(e,t)},e};return r.onceOn=function(t){var n=i({callback:function(){e.remove(n),t.apply(r,arguments)}});return o.push(n),n},r.off=function(t){e.remove(t)},r.trigger=function(){var t=Array.prototype.slice.call(arguments);o.forEach(function(e){e.execute(t)})},r.dispose=function(){o.slice().forEach(function(t){t.unbind()})},e.push=function(t){o.push(t),t.bind(r)},e.remove=function(t){o.splice(o.indexOf(t),1)},r},e=function(){function e(e){return n(e)||r(t(),e),i[e]}function n(t){return void 0!==i[t]}function r(t,e){return u.push(t),e&&(i[e]=t),t}var o={},i={},u=[];return o.createEvent=function(e){return r(t(),e)},o.on=function(t,n){return e(t).on(n)},o.off=function(t,n){return e(t).off(n)},o.onceOn=function(t,n){return e(t).onceOn(n)},o.trigger=function(t){var n=Array.prototype.slice.call(arguments,1),r=e(t);r.trigger.apply(o,n)},o.dispose=function(){u.forEach(function(t){t.dispose()}),i={},u=[]},o},n=function(){var t={},n={};return t.register=function(t){if(n[t])throw"A event category is already registered for "+t;return n[t]=e(),n[t]},t.at=function(e){return n[e]||t.register(e),n[e]},t}();return n.eventCategory=e,n.eventhandler=e,n.event=t,n}),o("router/routeMatchResult",["klassified"],function(t){var e=t.object.subclass(function(t,e){function n(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);return n}var r,o,i,u,a;e.initialize=function(t){e.super(t),r=t.url,o=t.route,i=r&&r.getQuery&&r.getQuery()||{},u=t.values||{},a=n(u,i)},t.getRoute=function(){return o},t.getUrl=function(){return r},t.isMatch=function(){return!0},t.getRouteParameters=function(){return u},t.getQueryParameters=function(){return r.getQuery()},t.getParameters=function(){return a},t.getActionArguments=function(){var t=Object.keys(u).map(function(t){return u[t]});return t.push(r.getQuery()),t}});return e.class(function(t){t.routeNoMatchResult=function(){var e=t();return e.isMatch=function(){return!1},e}()}),e}),o("router/route",["./routeFactory","../events","./routeMatchResult","jquery","./url","klassified"],function(t,e,n,r,o,i){function u(t){var e,n,r=[],o=Math.pow(2,t.length);for(n=1;n<o;n++){e=[];var i=t.length-1;do 0!==(n&1<<i)&&e.unshift(t[i]);while(i--);r.unshift(e)}return r}var a=i.object.subclass(function(r,i){function a(t,e){return e=e||l,!(t.length!==e.length&&!d)&&e.every(function(e,n){var r=t[n];return void 0!==r&&e.match(r)})}function c(t){var e=t.getSegments();if(a(e))return l;var n;for(n=0;n<p.length;n++)if(a(e,p[n]))return p[n];return null}function s(){var t=[];if(l.forEach(function(e,n){e.isOptional()&&t.push(n)}),t.length>15)throw new Error('Too many optional arguments. "'+t.length+'" optionals would generate  '+Math.pow(2,t.length)+" optional sequences.");var e=u(t);e.forEach(function(t){var e=l.slice();t.forEach(function(t,n){e.splice(t-n,1)}),p.push(e)})}function f(t,e){var o=e.getSegments(),i={};return l.forEach(function(e){if(e.isParameter()){var n=t.indexOf(e);n>=0?i[e.getName()]=e.getValue(o[n]):i[e.getName()]=e.getValue()}}),n({route:r,url:e,values:i})}var l,d,p;i.initialize=function(e){i.super(),l=t(e.pattern,e.options),d=e.options&&e.options.ignoreTrailingSegments||!1,p=[],s()},i.events=e.eventCategory(),r.onMatched=i.events.createEvent("matched"),r.on=i.events.on,r.matchUrl=function(t){var e=c(t);if(!e)return n.routeNoMatchResult;var r=f(e,t);return i.events.trigger("matched",r),r},r.expand=function(t){t=t||{};var e=[];l.forEach(function(n){var r;if(r=n.isParameter()?t[n.getName()]:n.getValue(),void 0!==r||!n.isOptional()){if(!n.match(r))throw new Error("Could not generate a valid URL");e.push(r)}});var n={};return Object.keys(t).forEach(function(e){r.hasParameter(e)||(n[e]=t[e],n[e]instanceof Array&&(n[e]=n[e].join(",")))}),o.build(e.join("/"),n).toString()},r.hasParameter=function(t){return l.some(function(e){return e.isParameter()&&e.getName()===t})},r.toString=function(){return"route("+l.join("/")+")"}});return a}),o("router/hashLocation",["jquery","../events","./url","klassified"],function(t,e,n,r){var o=!("onhashchange"in window),i=25,u=r.object.subclass(function(r,u){function a(){return window.location.hash}function c(t){window.location.hash=t}function s(t){return"string"==typeof t&&(t=n({rawUrl:t})),"#!/"+t.toString()}function f(t){return n({rawUrl:t.replace(/^#!?[\/]?/,"")})}function l(t){t=t||a(),u.currentHash!==t&&(u.currentHash=t,u.history.push(u.currentHash)),r.onChanged.trigger(f(u.currentHash))}function d(){var t=a(),e=u.currentHash!==t;e&&l(t)}var p=null;u.currentHash=void 0,u.history=[],u.events=e.eventCategory(),r.onChanged=u.events.createEvent("changed"),r.setUrl=function(t){var e=s(t);c(e),l(e)},r.getUrl=function(){return f(a())},r.linkToUrl=function(t){return s(t)},r.back=function(t){r.isHistoryEmpty()?t&&c(s(t)):(u.history.pop(),c(u.history.pop())),l()},r.isHistoryEmpty=function(){return u.history.length<=1},r.start=function(){r.stop(),u.currentHash=a(),u.history=[u.currentHash],o?p=setInterval(d,i):t(window).bind("hashchange",d)},r.stop=function(){p&&(clearInterval(p),p=null),t(window).unbind("hashchange",d)}});return u}),o("router/router",["jquery","../events","./route","./url","./hashLocation","klassified"],function(t,e,n,r,o,i){var u=function(){return u.instance||(u.instance=o()),u.instance},a=i.object.subclass(function(t,o){function i(){var t=Array.prototype.slice.call(arguments),e={};return t.forEach(function(t){Object.keys(t).forEach(function(n){e[n]=t[n]})}),e}o.initialize=function(t){o.super(t),o.location=t.locationHandler||u(),o.routeTable=[],o.lastMatch=void 0,o.defaultParameters={},o.location.onChanged(function(){o.resolveUrl()})},o.events=e.eventCategory(),t.onRouteMatched=o.events.createEvent("routeMatched"),t.onRouteNotFound=o.events.createEvent("routeNotFound"),t.onResolveUrl=o.events.createEvent("resolveUrl"),t.on=o.events.on,t.resolveUrl=function(t){"string"==typeof t&&(t=r({rawUrl:t})),o.resolveUrl(t)},t.addRoute=function(t){t=t||{};var e=n({pattern:t.pattern,options:t});return t.action&&e.onMatched(function(e){t.action.apply(this,e.getActionArguments())}),e.name=t.name,e.fallThrough=t.fallThrough,e.priority=t.priority,o.addRoute(e),e},t.findRoute=function(t){for(var e=o.routeTable.length,n=0;n<e;n++){var r=o.routeTable[n];if(t(r))return r}return null},t.getRouteByName=function(e){return t.findRoute(function(t){return t.name&&t.name===e})},t.removeRoute=function(t){var e=o.routeTable.indexOf(t);if(e===-1)throw new Error("Route not in route table");o.routeTable.splice(e,1)},t.clear=function(){o.routeTable=[],o.lastMatch=void 0},t.pipeRoute=function(e,n){if(!e||!e.pattern)throw new Error("Route pattern required");var r=t.addRoute(e);return r.onMatched(function(t){n.resolveUrl(t.getUrl())}),r},t.pipeNotFound=function(e){return t.onRouteNotFound(function(t){e.resolveUrl(t)})},t.getUrl=function(){return o.location.getUrl()},t.linkTo=function(e,n,r){var i=t.getRouteByName(e);return i?o.location.linkToUrl(t.expand({routeName:i.name,parameters:n,excludeCurrentParameters:!r})):t.linkToPath(e,n)},t.linkToPath=function(e,n){return t.linkToUrl(r.build(e,n))},t.linkToUrl=function(t){return o.location.linkToUrl(t)},t.redirectTo=function(e,n,r){var i=t.getRouteByName(e);return i?o.location.setUrl(t.expand({routeName:i.name,parameters:n,excludeCurrentParameters:!r})):t.redirectToPath(e,n)},t.redirectToPath=function(e,n){return t.redirectToUrl(r.build(e,n))},t.redirectToUrl=function(t){return o.location.setUrl(t)},t.expand=function(e){var u,a=e.routeName,c=e.parameters||{},s=e.excludeCurrentParameters||!1;u=a?t.getRouteByName(a)||n():o.lastMatch?o.lastMatch.getRoute():n();var f=s?{}:t.getParameters(),l=i(f,c);Object.keys(o.defaultParameters).forEach(function(t){t in l||(l[t]="function"==typeof o.defaultParameters[t]?o.defaultParameters[t]():o.defaultParameters[t])});var d=u.expand(l);return r({rawUrl:d})},t.linkToParameters=function(e,n){return o.location.linkToUrl(t.expand({parameters:e,excludeCurrentParameters:n}))},t.setParameters=function(e,n){t.redirectToUrl(t.expand({parameters:e,excludeCurrentParameters:n}))},t.getParameters=function(){return o.lastMatch?o.lastMatch.getParameters():o.location.getUrl().getQuery()},t.getParameter=function(e){var n=t.getParameters();return n[e]},t.setDefaultParameter=function(t,e){o.defaultParameters[t]=e},t.back=function(t){return o.location.back(t)},t.isHistoryEmpty=function(){return o.location.isHistoryEmpty()},t.start=function(){o.location.start(),o.resolveUrl()},t.stop=function(){o.location.stop()},o.resolveUrl=function(e){var n=void 0===e?o.location.getUrl():e;t.onResolveUrl.trigger(n);var r=0;o.routeTable.some(function(e){var i=n.matchRoute(e);return!(!i.isMatch()||(o.lastMatch=i,r++,t.onRouteMatched.trigger(i),void 0!==e.fallThrough&&e.fallThrough!==!1))||null}),0===r&&t.onRouteNotFound.trigger(n.toString())},o.addRoute=function(t){var e=o.routeTable.length;if(void 0!==t.priority){do--e;while(o.routeTable[e]&&(void 0===o.routeTable[e].priority||t.priority<o.routeTable[e].priority));e+=1}o.routeTable.splice(e,0,t)}});return a}),o("router",["./router/url","./router/route","./router/router"],function(t,e,n){var r=n();return{url:t,route:e,router:n,getRouter:function(){return r},setRouter:function(t){r=t}}}),o("widget",["klassified","./widget-extensions","./router","./events","./htmlCanvas","jquery"],function(t,e,n,r,o,i){function u(){return!!s.get()}function a(t,e){var n=s.get();try{s.set(e),t()}finally{s.set(n)}}var c=function(){var t={},e=0;return t.newId=function(){return e+=1,e.toString()},t}(),s=function(){var t;return{get:function(){return t},set:function(e){t=e}}}(),f=t.object.abstractSubclass(function(t,f){function l(e){f.withChildrenRegistration(function(){t.renderOn(e)})}var d,p;f.initialize=function(t){f.super(t),p=t.id||c.newId(),f.inUpdateTransaction=!1,d=[]},f.initializeSubwidgets=function(t){},f.postInitialize=function(t){f.initializeSubwidgets(t)},f.events=r.eventCategory(),t.onAttach=f.events.createEvent(),t.onDetach=f.events.createEvent(),t.getId=function(){return p},t.id=t.getId,t.dispose=function(){d.forEach(function(t){t.dispose()}),f.dispose(),f.events.dispose()},t.willDetach=function(){d.forEach(function(t){t.willDetach()}),f.willDetach(),t.onDetach.trigger()},t.appendTo=function(t){f.withAttachHooks(function(){l(o(t))})},t.replace=function(t){f.withAttachHooks(function(){var e=o(t);e.root.asJQuery().empty(),l(e)})},t.asJQuery=function(){return i("#"+t.getId())},t.isRendered=function(){return t.asJQuery().length>0},t.appendToBrush=function(t){f.withAttachHooks(function(){l(o(t.asJQuery()))})},t.triggerWillAttach=function(){f.willAttach(),d.forEach(function(t){t.triggerWillAttach()})},t.triggerDidAttach=function(){f.didAttach(),d.forEach(function(t){t.triggerDidAttach()}),t.onAttach.trigger()},f.withAttachHooks=function(e){var n=u();n||t.triggerWillAttach(),e(),n||t.triggerDidAttach()},f.createEvent=function(e){t[e]=f.events.createEvent()},f.createEvents=function(){var t=Array.prototype.slice.apply(arguments);t.forEach(f.createEvent)},t.on=f.events.on,t.onceOn=f.events.onceOn,t.off=f.events.off,t.trigger=f.events.trigger,f.nextId=function(){return c.newId()},f.dispose=function(){},f.router=n.getRouter(),f.linkTo=f.router.linkTo,f.linkToPath=f.router.linkToPath,f.linkToUrl=f.router.linkToUrl,f.redirectTo=f.router.redirectTo,f.redirectToPath=f.router.redirectToPath,f.redirectToUrl=f.router.redirectToUrl,f.getParameters=f.router.getParameters,f.getParameter=f.router.getParameter,f.setParameters=f.router.setParameters,t.renderOn=function(e){f.renderRootOn(e).render(t.renderContentOn)},f.withChildrenRegistration=function(e){var n=s.get();n&&n.registerChild(t),a(function(){d=[],e()},t)},t.registerChild=function(t){d.push(t)},f.renderRootOn=function(t){return t.tag("widgetjs-widget").id(p)},t.renderContentOn=function(t){return f.subclassResponsibility()},f.willAttach=function(){},f.didAttach=function(){},f.willDetach=function(){},f.willUpdate=function(){},t.update=function(){!f.inUpdateTransaction&&t.isRendered()&&(f.willUpdate(),f.withAttachHooks(function(){var e=o();l(e),t.asJQuery().replaceWith(e.root.element)}))},t.withinTransaction=function(t,e){if(f.inUpdateTransaction)t();else try{f.inUpdateTransaction=!0,t()}finally{f.inUpdateTransaction=!1,e&&e()}},t.withUpdate=function(e){t.withinTransaction(e,t.update)},t.withNoUpdate=function(e){t.withinTransaction(e)};for(var g in e)e.hasOwnProperty(g)&&(f[g]=e[g]);return t});return f}),o("widgetjs",["./htmlCanvas","./widget","./widget-extensions","./router","./events"],function(t,e,n,r,o){return{htmlCanvas:t,widget:e,ext:n,router:r,events:o}}),r(["widgetjs"]),r("widgetjs")});