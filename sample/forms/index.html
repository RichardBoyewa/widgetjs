<!DOCTYPE html>
<html>
<head>
    <title>Forms Sample</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
    <script type='text/javascript' src='../../bower_components/requirejs/require.js'></script>

    <script type="text/javascript">
        requirejs.config({
            baseUrl: '.',
            paths:   {
                'jquery':   '../../bower_components/jquery/jquery',
                'widgetjs': '../../src/',
                'bootstrap': 'http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min'
            },
            shim:    {
                bootstrap: { deps: ['jquery'], exports: 'jQuery' }
            }
        });

        require(['widgetjs/core', 'jquery'], function(widgetjs, jQuery) {
            jQuery(document).ready(function() {

                function address (spec) {
                    var that = {};

                    that.street = widgetjs.property.string({ value: spec.street, label: 'Street'});
                    that.city = widgetjs.property.string({ value: spec.city, label: 'City'});

                    return that;
                }

                function role (spec) {
                    var that = {};

                    that.name = spec.name;
                    that.id = spec.id || spec.name;

                    return that;
                }

                var roles = [role({ name: 'Limited'}), role({ name: 'Normal'}), role({ name: 'Admin'})];

                function user(spec) {
                    var that = {};

                    that.id = widgetjs.property.string({ value: spec.name, label: 'Id'});
                    that.name = widgetjs.property.string({ value: spec.name, label: 'Name'});
                    that.age = widgetjs.property.number({ value: spec.age, label: 'Age'});
                    that.isAdmin = widgetjs.property.bool({ value: spec.isAdmin, label: 'Is Administrator'});
                    that.password = widgetjs.property.password({ value: spec.password, label: 'Password'});

                   that.role = widgetjs.property.object({
                        value: spec.role,
                        label: 'Role in company',
                        options: roles,
                        optionLabel: function(role) {
                            return role.name;
                        },
                        optionValue: function(role) {
                            return role.id;
                        }
                    });

                    // ?
                    that.address = widgetjs.property.object({ value: spec.address, label: 'Address'});

                    return that;
                }

                var john = user({ name: 'Johan Doe', age: 95, isAdmin: true,
                    password: 'secret', role: roles[1], address: address({street: 'Skeppsbron 26', city: 'Stockholm'}) });

                window.user = john;

                var html = widgetjs.htmlCanvas('body');
                var container = html.div({ 'class' : 'container'});
                container.render(function(html) {


                    // Render user
                    html.h1('Model');
                    html.dl(
                            html.dt('Name'),
                            html.dd(john.name),
                            html.dt('Age'),
                            html.dd(john.age),
                            html.dt('Is Administrator'),
                            html.dd(widgetjs.computedProperty({properties : [john.isAdmin], fn : function(isAdmin) {
                                return isAdmin ? 'YES' : 'NO';
                            }})),
                            html.dt('Role'),
                            html.dd(widgetjs.computedProperty({properties : [john.role], fn : function(role) {
                                return role.name;
                            }}))
                    );


                    // Form generated from model
                    html.h1('Properties');
                    var userForm = widgetjs.formWidget({
                        model: john,
                        //generateFields: false,
                        fieldOptions: {
                            name: { // overrides
                                label: 'Secret Name',
                                field: 'password'
                            }
                        },
                        exclude: ['id']
                        //include: ['name', 'isAdmin', 'role']
                    });

                    userForm.appendModelProperties();
                    html.render(userForm);

                    // Mutator/Accessor
                    html.h1('Mutator/Accessor');
                    var customForm = widgetjs.formWidget();
                    customForm.input({
                        accessor: john.name.get,
                        mutator: john.name.set
                    });
                    customForm.number({
                        accessor: john.age.get,
                        mutator: john.age.set
                    });
                    customForm.checkbox({
                        accessor: john.isAdmin.get,
                        mutator: john.isAdmin.set
                    });
                    customForm.password({
                        accessor: john.password.get,
                        mutator: john.password.set
                    });
                    customForm.select({
                        accessor: john.role.get,
                        mutator: john.role.set,
                        options: john.role.options,
                        optionLabel: function(role) {
                            return role.name;
                        },
                        optionValue: function(role) {
                            return role.id;
                        }
                    });

                    html.render(customForm);

                    html.hr();

                    // Values
                    html.h1('Values');
                    var valueForm = widgetjs.formWidget();
                    valueForm.input({value: john.name.get() });
                    valueForm.number({value: john.age.get() });
                    valueForm.checkbox({value: john.isAdmin.get() });
                    valueForm.password({value: john.password.get() });
                    valueForm.select({
                        value: john.role.get(),
                        options: john.role.options,
                        optionLabel: function(role) {
                            return role.name;
                        },
                        optionValue: function(role) {
                            return role.id;
                        }
                    });
                    html.render(valueForm);

                    html.h1('Attributes');

                    var john2 = {
                        name: john.name.get(),
                        age: john.age.get(),
                        password: john.password.get(),
                        settings : {
                            isAdmin: john.isAdmin.get(),
                            role: john.role.get()
                        }
                    };

                    var attributeForm = widgetjs.formWidget({model: john2});
                    attributeForm.input({
                        attribute: 'name'
                    });
                    attributeForm.number({
                        attribute: 'age'
                    });
                    attributeForm.checkbox({
                        attribute: 'settings.isAdmin'
                    });
                    attributeForm.password({
                        attribute: 'password'
                    });
                    attributeForm.select({
                        attribute: 'settings.role',
                        options: john.role.options,
                        optionLabel: function(role) {
                            return role.name;
                        },
                        optionValue: function(role) {
                            return role.id;
                        }
                    });
                    html.render(attributeForm);

                    html.hr();
                    // Form generated from model
                    html.h1('Custom Form');
                    var aForm = function(spec, my) {
                        spec = spec || {};
                        my = my || {};
                        var that = widgetjs.formWidget(spec, my);

                        that.renderContentOn = function(html) {
                            html.form(
                                    html.dl(
                                            html.dt('Name'),
                                            html.dd(my.getFieldByName('name')),
                                            html.dt('Age'),
                                            html.dd(my.getFieldByName('age')),
                                            html.dt('Is Administrator'),
                                            html.dd(my.getFieldByName('isAdmin')),
                                            html.dt('Role'),
                                            html.dd(my.getFieldByName('role'))
                                    )
                            );
                        };

                        return that;
                    }({ model: john });
                    aForm.appendModelProperties();
                    html.render(aForm);

                    html.hr();
                    html.h1('Bootsrap');
                    html.h2('Basic');
                    var basicForm = widgetjs.formWidget.basicForm({ model: john });
                    basicForm.appendModelProperties();
                    html.render(basicForm);

                    html.h2('Inline');
                    var inlineForm = widgetjs.formWidget.inlineForm({ model: john });
                    inlineForm.appendModelProperties();
                    html.render(inlineForm);

                    html.h2('Horizontal');
                    var horizontalForm = widgetjs.formWidget.horizontalForm({ model: john });
                    horizontalForm.appendModelProperties();
                    html.render(horizontalForm);

                });

            });
        });

    </script>
</head>
<body></body>
</html>